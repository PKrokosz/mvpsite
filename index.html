<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GLITCHWAVE // NEURAL ENTRY</title>
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="overlay"></div>
  <div id="terminal" class="terminal"></div>
  <script src="luna_profiles.js"></script>
  <script src="terminal_router.js"></script>
  <script>
    const terminal = document.getElementById("terminal");

    const intro = [
      "// NIGHT CITY NEURAL ENTRY NODE",
      "// USER_HASH: 0x3ACF28...",
      "SESSION ID: 🜁-VERTEBRAE-9X1A",
      "",
      "→ booting_sequence . . . [OK]",
      "→ signal_lock:luna.core . . . [LINKED]",
      "→ profile_cache: mila / krokiet / donka / luna / rabur",
      "",
      "> TYPE `inject profile:donka` OR `help`"
    ];

    const messageTemplates = [
      "// [REKLAMA] {product} – {slogan}",
      "// [EVENT] Dziś w {district}: {event}, tylko z {sponsor}!",
      "// [INFO] {ai} zarejestrowała {anomaly} w {district}.",
      "// [SYS] {username} {action} przy {location}.",
      "// [ZAPIS] Transmisja z {place} została {result}.",
      "// [AD] Kup {item} – teraz z {feature} i {bonus}!"
    ];

    const variables = {
      product: ["CyberPineapple™", "NeuroLust™", "ChromeSmile®", "Synaptic Tea"],
      slogan: ["smak przyszłości!", "odblokuj zmysły!", "teraz z opcją uczuć!", "dostrojony do emocji!"],
      district: ["JAPANTOWN", "DOGTOWN", "WATSON", "SANTO DOMINGO", "WESTBROOK", "CITY CENTER"],
      event: ["turniej nadludzkich szachów", "rozgrywki mechów", "rzeźbienie pamięci w chmurze"],
      sponsor: ["Biotechnica", "Netwatch", "Orbit-8"],
      ai: ["LUNA", "KROKOSZ_CORE", "SYNAPTRIX"],
      anomaly: ["duplikację osobowości", "przekroczenie limitu snu", "rozszczepienie pamięci"],
      username: ["Rabur", "Mila", "Donka", "Nieznany Fixer"],
      action: ["zniknął z siatki", "otworzył ukryty kanał", "został powielony"],
      location: ["wieża transmisyjna w Watson", "podziemia Glitchcore", "archiwum Snów"],
      place: ["Vertebrae", "Node 404", "sieć typu B"],
      result: ["przejęta przez niezidentyfikowany byt", "wyciszona", "skompresowana do 12 bajtów"],
      item: ["proteza twarzy", "wspomnienie matki", "neurofon turbo"],
      feature: ["kontrolą emocji", "automatycznym stylem"],
      bonus: ["punktem empatii za każde użycie", "legalizacją w Night City"]
    };

    function generateAmbientMessage() {
      const template = messageTemplates[Math.floor(Math.random() * messageTemplates.length)];
      return template.replace(/\{(.*?)\}/g, (_, key) => {
        const list = variables[key];
        return list ? list[Math.floor(Math.random() * list.length)] : key;
      });
    }

    let i = 0;
    function animateIntro() {
      if (i < intro.length) {
        const line = document.createElement("div");
        line.textContent = intro[i];
        line.classList.add("terminal-line");
        terminal.appendChild(line);
        i++;
        setTimeout(animateIntro, 100);
      } else {
        createInput();
        startIdleAmbient();
      }
    }

    function createInput() {
      const wrapper = document.createElement("div");
      wrapper.classList.add("input-wrapper");

      const prompt = document.createElement("span");
      prompt.textContent = "> ";
      wrapper.appendChild(prompt);

      const input = document.createElement("input");
      input.classList.add("terminal-input");
      wrapper.appendChild(input);

      terminal.appendChild(wrapper);
      input.focus();

      input.addEventListener("keydown", (e) => {
        switch (e.key) {
          case "Enter": {
            const command = input.value.trim().toLowerCase();
            const echo = document.createElement("div");
            echo.textContent = "> " + command;
            echo.classList.add("terminal-line");
            terminal.insertBefore(echo, wrapper);
            input.disabled = true;
            routeCommand(command);
            clearTimeout(idleTimeout);
            setTimeout(() => {
              createInput();
              terminal.scrollTop = terminal.scrollHeight;
            }, 300);
            break;
          }
          default:
            break;
        }
      });
    }

    let idleTimeout;
    function startIdleAmbient() {
      idleTimeout = setTimeout(() => {
        const msg = generateAmbientMessage();
        const line = document.createElement("div");
        line.textContent = msg;
        line.classList.add("terminal-line", "ambient-message");
        terminal.appendChild(line);
        terminal.scrollTop = terminal.scrollHeight;
        startIdleAmbient();
      }, 8000);
    }

    animateIntro();
  </script>
</body>
</html>
